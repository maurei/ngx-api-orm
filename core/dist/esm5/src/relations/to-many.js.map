{"version":3,"file":"to-many.js","sourceRoot":"","sources":["../../../src/relations/to-many.ts"],"names":[],"mappings":"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","sourcesContent":["import { RelationConfiguration } from './relation-configuration';\nimport { Resource } from '../resource.core';\nimport { METAKEYS, HttpClientOptions } from '../utils';\nimport { ToManyBuilder } from '../request-handlers/default-builders';\nimport { ToManyAdapter } from '../request-handlers/default-adapters';\n\n// @dynamic\nexport class ToManyRelation<THost extends Resource, TRelated extends Resource> extends Array<TRelated> {\n\tconstructor(\n\t\tprivate readonly _hostInstance: THost,\n\t\tprivate readonly _configuration: RelationConfiguration<THost, TRelated>,\n\t\tprivate readonly _adapter: ToManyAdapter,\n\t\tprivate readonly _builder: ToManyBuilder\n\t) {\n\t\tsuper();\n\t\tconst rawObjects: Array<{}> = _hostInstance[_configuration.keyOnInstance] || null;\n\t\tif (rawObjects == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst instances = Array.prototype.concat.apply([], [<TRelated[]>_configuration.RelatedResource.factory(rawObjects)]);\n\t\tthis.push(...instances);\n\t}\n\t// TODO: IMPLEMENT FETCH (LAZY GETTING OF RELATIONS)\n\t// TODO: IMPLEMENT SET (LAZY SYNC OF CHANGES: COMPLETE REPLACE)\n\n\t/*tslint:disable semicolon*/\n\t/**\n\t * Runs the add pipeline of your model for a related resource using the To-Many request adapter and builder.\n\t * @param  TRelated relatedInstance\n\t * @param  any={} options\n\t */\n\tpublic add = async (relatedInstance: TRelated, options: HttpClientOptions = {}): Promise<void> => {\n\t\tconst hostName = Reflect.getMetadata(METAKEYS.NAME, this._configuration.HostResource);\n\t\tconst relatedName = Reflect.getMetadata(METAKEYS.NAME, this._configuration.RelatedResource);\n\n\t\tif (!(relatedInstance instanceof this._configuration.RelatedResource)) {\n\t\t\tthrow new TypeError('parameter relatedInstance must be of type ' + relatedName);\n\t\t}\n\n\t\tconst body = this._adapter.add(relatedInstance, this._hostInstance);\n\t\tawait this._builder.add(relatedName, hostName, body, this._hostInstance, options);\n\t\tthis.push(relatedInstance);\n\t};\n\n\t/**\n\t * Runs the delete pipeline of your model for a related resource using the To-Many request adapter and builder.\n\t * @param  TRelated relatedInstance\n\t * @param  any={} options\n\t */\n\tpublic remove = async (relatedInstance: TRelated, options: HttpClientOptions = {}) => {\n\t\tconst hostName = Reflect.getMetadata(METAKEYS.NAME, this._configuration.HostResource);\n\t\tconst relatedName = Reflect.getMetadata(METAKEYS.NAME, this._configuration.RelatedResource);\n\n\t\tif (this.findIndex(ri => ri.id === relatedInstance.id) === -1) {\n\t\t\tthrow new RangeError('parameter relatedInstance not included in this RelatedResourceCollection');\n\t\t}\n\t\tconst body = this._adapter.remove(relatedInstance, this._hostInstance);\n\t\tawait this._builder.remove(relatedName, hostName, body, this._hostInstance, options);\n\t\tthis._removeInstance(relatedInstance);\n\t};\n\n\t/** @internal */\n\tprivate _removeInstance = (relatedInstance: TRelated) => {\n\t\tfor (let n = 0; n < this.length; n++) {\n\t\t\tif (this[n].id === relatedInstance.id) {\n\t\t\t\tthis.splice(n, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\t/*tslint:enable semicolon*/\n}\n"]}